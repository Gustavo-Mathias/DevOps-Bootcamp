
name: CI-CD
on:
  push:
    branches: [ "main" ]
  workflow_dispatch:
jobs:
    CI:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v5
              
            - uses: actions/setup-python@v6
              with:
                python-version: '3.11' 
                
            - name: Install Dependencies
              working-directory: 02-encontros-tech
              run: |
                python -m pip install --upgrade pip 
                pip install -r requirements.txt
            
            - name: Testes
              working-directory: 02-encontros-tech
              run: python -m pytest tests/ -v  
                
            - run: echo "Executar o Docker Build"
            - run: echo "Enviar a Imagem Docker para o Docker Hub"

            - name: Debug - Check if secrets exist
              run: |
                echo "Checking secrets..."
                if [ -z "${{ secrets.DOCKERHUB_USERNAME }}" ]; then
                  echo "ERROR: DOCKERHUB_USERNAME secret is not set or is empty"
                else
                  echo "DOCKERHUB_USERNAME is set"
                fi
                if [ -z "${{ secrets.DOCKERHUB_TOKEN }}" ]; then
                  echo "ERROR: DOCKERHUB_TOKEN secret is not set or is empty"
                else
                  echo "DOCKERHUB_TOKEN is set"
                fi

            - name: Login to Docker Hub
              uses: docker/login-action@v3
              with:
                username: ${{ secrets.DOCKERHUB_USERNAME }}
                password: ${{ secrets.DOCKERHUB_TOKEN }}

    CD:
        runs-on: ubuntu-latest
        needs: [CI]
        steps:
            - run: echo "Obter o c√≥digo"
            - run: echo "Configurar o Kubeconfig"
            - run: echo "Executar o apply"